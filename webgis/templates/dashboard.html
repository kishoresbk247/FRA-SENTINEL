<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRA Sentinel - Advanced Forest Rights Monitoring System</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/unified-buttons.css') }}" rel="stylesheet">
    <style>
    :root {
    /* Beautiful Green Gradient Color Palette */
    --primary-gradient: linear-gradient(135deg, #0d4f3c 0%, #1b5e20 25%, #2e7d32 50%, #4caf50 75%, #81c784 100%);
    --secondary-gradient: linear-gradient(135deg, #1b5e20 0%, #4caf50 100%);
    --success-gradient: linear-gradient(135deg, #2e7d32 0%, #81c784 100%);
    --warning-gradient: linear-gradient(135deg, #ff8f00 0%, #ffb74d 100%);
    --info-gradient: linear-gradient(135deg, #1b5e20 0%, #66bb6a 100%);
    --dark-gradient: linear-gradient(135deg, #0d4f3c 0%, #1b4332 100%);
    
    --surface-gradient: linear-gradient(135deg, #ffffff 0%, #f1f8e9 100%);
    --card-gradient: linear-gradient(135deg, #ffffff 0%, #f9fbe7 100%);
    --sidebar-gradient: linear-gradient(180deg, #ffffff 0%, #f1f8e9 50%, #e8f5e8 100%);
    
    --text-primary: #1a1a1a;
    --text-secondary: #2e7d32;
    --text-light: #4caf50;
    --border-color: #c8e6c9;
    --shadow: 0 8px 32px rgba(13, 79, 60, 0.08);
    --shadow-hover: 0 16px 48px rgba(13, 79, 60, 0.12);
    
    --border-radius: 16px;
    --border-radius-small: 12px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    
    --spacing-xs: 8px;
    --spacing-sm: 12px;
    --spacing-md: 16px;
    --spacing-lg: 24px;
    --spacing-xl: 32px;
    --spacing-xxl: 48px;
}
/* Top Navigation Bar Styles */
.top-navbar {
    background: linear-gradient(135deg, #0d4f3c 0%, #1b5e20 25%, #2e7d32 50%, #4caf50 75%, #81c784 100%);
    color: white;
    padding: 12px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 4px 20px rgba(13, 79, 60, 0.3);
    position: sticky;
    top: 0;
    z-index: 1000;
    backdrop-filter: blur(10px);
}

.navbar-brand h1 {
    font-size: 1.8rem;
    font-weight: 700;
    margin: 0;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.navbar-center {
    flex: 1;
    display: flex;
    justify-content: center;
}

.nav-features {
    display: flex;
    gap: 8px;
}

.nav-btn {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    backdrop-filter: blur(10px);
    text-decoration: none;
}

.nav-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.nav-icon {
    font-size: 1.1rem;
}

.navbar-right {
    display: flex;
    align-items: center;
    gap: 16px;
}

.language-switcher select {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 6px 12px;
    border-radius: 15px;
    font-size: 0.85rem;
    cursor: pointer;
    backdrop-filter: blur(10px);
}

.language-switcher select option {
    background: #1b5e20;
    color: white;
}

.user-profile {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.1);
    padding: 6px 12px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.user-profile:hover {
    background: rgba(255,255,255,0.2);
}

.profile-avatar {
    width: 32px;
    height: 32px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.avatar-icon {
    font-size: 1.2rem;
}

.profile-info {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.profile-name {
    font-size: 0.9rem;
    font-weight: 600;
    line-height: 1;
}

.profile-role {
    font-size: 0.75rem;
    opacity: 0.8;
    line-height: 1;
}

.admin-dropdown {
    position: relative;
}

.admin-btn {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    backdrop-filter: blur(10px);
}

.admin-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.dropdown-arrow {
    font-size: 0.7rem;
    transition: transform 0.3s ease;
}

.admin-menu {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.15);
    min-width: 180px;
    padding: 8px 0;
    margin-top: 8px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 99999;
}

.admin-menu.show {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

.admin-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 16px;
    color: #333;
    text-decoration: none;
    transition: all 0.2s ease;
    font-size: 0.9rem;
}

.admin-item:hover {
    background: #f0f9ff;
    color: #1b5e20;
}

.admin-divider {
    height: 1px;
    background: #e5e7eb;
    margin: 4px 0;
}

.logout-item {
    color: #dc2626;
}

.logout-item:hover {
    background: #fef2f2;
    color: #dc2626;
}

.logout-btn {
    background: rgba(255,255,255,0.15);
    border: 1px solid rgba(255,255,255,0.2);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    text-decoration: none;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    backdrop-filter: blur(10px);
}

.logout-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Enhanced Green Theme Styles */
.header {
    background: linear-gradient(135deg, #0d4f3c 0%, #1b5e20 25%, #2e7d32 50%, #4caf50 75%, #81c784 100%);
    color: white;
    padding: var(--spacing-xl) var(--spacing-lg);
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(13, 79, 60, 0.2);
}

.header h1 {
    font-size: 3rem;
    font-weight: 700;
    margin: 0 0 var(--spacing-sm) 0;
    background: linear-gradient(45deg, #ffffff, #e8f5e8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    line-height: 1.2;
}

/* Green-themed buttons */
.control-button:hover {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    color: white;
    transform: translateX(2px);
}

.control-button.active {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    color: white;
    box-shadow: 0 2px 8px rgba(13, 79, 60, 0.3);
}

.tab-button.active {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    color: white;
    box-shadow: 0 4px 12px rgba(13, 79, 60, 0.2);
}

/* Green-themed village avatar */
.village-avatar {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    box-shadow: 0 4px 12px rgba(13, 79, 60, 0.3);
}

.village-avatar::after {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

/* Green-themed stat values */
.stat-value {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.village-details h3 {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.scheme-name {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.section-icon {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Green-themed chatbot */
.chatbot-fab {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    box-shadow: 0 8px 32px rgba(13, 79, 60, 0.3);
}

.chatbot-fab:hover {
    box-shadow: 0 12px 40px rgba(13, 79, 60, 0.4);
}

.chatbot-header {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.bot-message .message-avatar {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.suggestion-btn {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    box-shadow: 0 2px 8px rgba(13, 79, 60, 0.2);
}

.suggestion-btn:hover {
    box-shadow: 0 4px 12px rgba(13, 79, 60, 0.3);
}

.chatbot-send-btn {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.chatbot-send-btn:hover {
    box-shadow: 0 4px 16px rgba(13, 79, 60, 0.3);
}

/* Green-themed priority badges */
.priority-high { 
    background: linear-gradient(135deg, #d32f2f, #f44336); 
    color: white; 
}
.priority-medium { 
    background: linear-gradient(135deg, #f57c00, #ff9800); 
    color: white; 
}
.priority-low { 
    background: linear-gradient(135deg, #2e7d32, #4caf50); 
    color: white; 
}

/* Green-themed score bars */
.score-fill {
    background: linear-gradient(135deg, #2e7d32, #4caf50);
}

.score-value {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Green-themed reason items */
.reason-item {
    background: linear-gradient(135deg, #e8f5e8, #f1f8e9);
    border-left: 4px solid #2e7d32;
}

.reason-check {
    color: #2e7d32;
}

/* Green-themed borders and accents */
.info-section::before {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.village-card::before {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.recommendation-item::before {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

.stat-item:hover::before {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

/* Green-themed map markers */
.leaflet-marker-icon {
    filter: hue-rotate(120deg);
}

/* Custom scrollbar with green theme */
::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #0d4f3c, #2e7d32);
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #1b5e20, #4caf50);
}


    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        color: var(--text-primary);
        line-height: 1.6;
        overflow-x: hidden;
    }
    
    /* Perfect Header Alignment */
    .header {
        background: var(--primary-gradient);
        color: white;
        padding: var(--spacing-xl) var(--spacing-lg);
        text-align: center;
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }
    
    .header::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        animation: shimmer 3s infinite;
    }
    
    @keyframes shimmer {
        0% { left: -100%; }
        100% { left: 100%; }
    }
    
    .header-content {
        position: relative;
        z-index: 2;
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .header h1 {
        font-size: 3rem;
        font-weight: 700;
        margin: 0 0 var(--spacing-sm) 0;
        background: linear-gradient(45deg, #ffffff, #e3f2fd);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        line-height: 1.2;
    }
    
    .header p {
        font-size: 1.25rem;
        opacity: 0.95;
        font-weight: 400;
        margin: 0;
    }
    
    /* Perfect Container Layout */
    .container {
        display: grid;
        grid-template-columns: 420px 1fr;
        gap: var(--spacing-lg);
        min-height: calc(100vh - 140px);
        padding: var(--spacing-lg);
        max-width: 1600px;
        margin: 0 auto;
        align-items: start;
    }
    
    /* Perfect Sidebar Alignment */
    .sidebar {
        background: var(--sidebar-gradient);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: var(--transition);
        border: 1px solid var(--border-color);
        height: fit-content;
        position: sticky;
        top: var(--spacing-lg);
    }
    
    .sidebar:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-hover);
    }
    
    /* Perfect Map Container */
    .map-container {
        background: var(--card-gradient);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
        position: relative;
        border: 1px solid var(--border-color);
        min-height: calc(100vh - 180px);
        height: calc(100vh - 180px);
    }
    
    #map {
        height: 100%;
        width: 100%;
    }
    
    /* Perfect Layer Controls Alignment */
    .map-controls {
        position: absolute;
        bottom: var(--spacing-md);
        right: var(--spacing-md);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        gap: var(--spacing-sm);
    }
    
    .control-group {
        background: var(--surface-gradient);
        border-radius: var(--border-radius-small);
        padding: var(--spacing-xs);
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        border: 1px solid var(--border-color);
        backdrop-filter: blur(10px);
        display: flex;
        flex-direction: column;
        gap: 4px;
    }
    
    .control-button {
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        background: transparent;
        border: none;
        border-radius: var(--spacing-xs);
        padding: var(--spacing-sm) var(--spacing-md);
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 500;
        transition: var(--transition);
        color: var(--text-primary);
        white-space: nowrap;
        min-width: 120px;
        justify-content: flex-start;
    }
    
    .control-button:hover {
        background: var(--primary-gradient);
        color: white;
        transform: translateX(2px);
    }
    
    .control-button.active {
        background: var(--primary-gradient);
        color: white;
        box-shadow: 0 2px 8px rgba(30, 60, 114, 0.3);
    }
    
    .control-icon {
        font-size: 1.1em;
        width: 20px;
        text-align: center;
    }
    
    /* Perfect Tab Navigation */
    .tab-navigation {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        background: var(--surface-gradient);
        border-bottom: 1px solid var(--border-color);
        padding: 6px;
        gap: 4px;
    }
    
    .tab-button {
        padding: var(--spacing-md) var(--spacing-sm);
        border: none;
        background: transparent;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 500;
        font-size: 0.95rem;
        color: var(--text-secondary);
        border-radius: var(--spacing-xs);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-xs);
        text-align: center;
    }
    
    .tab-button:hover {
        background: rgba(255,255,255,0.7);
        color: var(--text-primary);
    }
    
    .tab-button.active {
        background: var(--primary-gradient);
        color: white;
        box-shadow: 0 4px 12px rgba(30, 60, 114, 0.2);
    }
    
    /* Perfect Tab Content */
    .tab-content {
        padding: var(--spacing-lg);
        max-height: calc(100vh - 280px);
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
    }
    
    .tab-pane {
        display: none;
    }
    
    .tab-pane.active {
        display: flex;
        flex-direction: column;
        gap: var(--spacing-lg);
        animation: fadeInUp 0.5s ease;
    }
    
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Perfect Info Section Alignment */
   .info-section {
    padding: var(--spacing-md);
    background: var(--card-gradient);
    border-radius: var(--border-radius-small);
    border: 1px solid var(--border-color);
    box-shadow: 0 2px 12px rgba(0,0,0,0.04);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    margin-bottom: var(--spacing-md);
}

    .info-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }
    
    .info-section:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.06);
    }
    
  .info-section h3 {
    color: var(--text-primary);
    font-weight: 600;
    font-size: 1.1rem;
    margin: 0 0 var(--spacing-sm) 0;
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    line-height: 1.2;
}

.section-icon {
    font-size: 1.2em;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    width: 20px;
    text-align: center;
}

    
   
    
    /* Perfect Stat Items Grid */
    .stats-grid {
        display: grid;
        gap: var(--spacing-sm);
        grid-template-columns: 1fr;
    }
    
.stat-item {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--surface-gradient);
    border-radius: var(--spacing-xs);
    border: 1px solid var(--border-color);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    min-height: 44px;
}

    .stat-item::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 0;
        background: var(--primary-gradient);
        transition: width 0.3s ease;
    }
    
    .stat-item:hover::before {
        width: 4px;
    }
    
    .stat-item:hover {
        transform: translateX(4px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    }
    
  .stat-label {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    font-weight: 500;
    color: var(--text-primary);
    font-size: 0.85rem;
}

.stat-icon {
    font-size: 1.1em;
    width: 18px;
    text-align: center;
}

.stat-value-container {
    text-align: right;
    display: flex;
    flex-direction: column;
    gap: 2px;
    align-items: flex-end;
}

.stat-value {
    font-weight: 600;
    font-size: 1rem;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.1;
}

.stat-subtext {
    font-size: 0.7rem;
    color: var(--text-light);
    margin: 0;
}

       
    /* Perfect Loading Animation */
    .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-xxl);
        color: var(--text-secondary);
        font-style: italic;
        font-size: 0.95rem;
    }
    
    .loading::before {
        content: '';
        width: 24px;
        height: 24px;
        border: 3px solid var(--border-color);
        border-top: 3px solid transparent;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        background: conic-gradient(from 0deg, transparent, #667eea);
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Perfect Village Card */
  .village-card {
    background: var(--card-gradient);
    border-radius: var(--border-radius-small);
    padding: var(--spacing-md);
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 16px rgba(0,0,0,0.04);
    position: relative;
    overflow: hidden;
}

    
    .village-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: var(--primary-gradient);
    }
    
   .village-header {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: var(--spacing-sm);
    align-items: center;
    margin-bottom: var(--spacing-md);
}

    .village-avatar {
    width: 48px;
    height: 48px;
    background: var(--primary-gradient);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    color: white;
    box-shadow: 0 4px 12px rgba(30, 60, 114, 0.25);
    flex-shrink: 0;
}

    
    .village-avatar::after {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: var(--primary-gradient);
        border-radius: 50%;
        z-index: -1;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.02); opacity: 0.9; }
    }
    
   .village-details h3 {
    margin: 0 0 2px 0;
    font-size: 1.2rem;
    font-weight: 600;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.2;
}

.village-details p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.85rem;
    font-weight: 400;
}

    
    
    .village-stats {
        display: grid;
        gap: var(--spacing-sm);
    }
    
    /* Perfect Recommendations */
  .recommendation-item {
    background: var(--card-gradient);
    padding: var(--spacing-md);
    border-radius: var(--border-radius-small);
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 16px rgba(0,0,0,0.04);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    margin-bottom: var(--spacing-sm);
}

    
    .recommendation-item::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 6px;
        background: var(--primary-gradient);
    }
    
    .recommendation-item:hover {
        transform: translateY(-2px) translateX(2px);
        box-shadow: 0 16px 48px rgba(0,0,0,0.08);
    }
    
    .scheme-header {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: var(--spacing-md);
        align-items: start;
        margin-bottom: var(--spacing-md);
    }
    
    .scheme-name {
        font-weight: 700;
        font-size: 1.3rem;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        line-height: 1.3;
    }
    
    .scheme-icon {
        font-size: 1.2em;
        width: 24px;
        text-align: center;
    }
    
    .priority {
        padding: var(--spacing-xs) var(--spacing-md);
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: none;
        color: white;
        white-space: nowrap;
    }
    
    .priority-high { background: var(--warning-gradient); }
    .priority-medium { background: var(--info-gradient); }
    .priority-low { background: var(--success-gradient); }
    
    .scheme-content {
        display: grid;
        gap: var(--spacing-md);
    }
    
    .scheme-details {
        color: var(--text-secondary);
        line-height: 1.6;
    }
    
    .scheme-details p {
        margin: var(--spacing-xs) 0;
    }
    
    .scheme-details strong {
        color: var(--text-primary);
    }
    
    .eligibility-reasons {
        display: grid;
        gap: var(--spacing-xs);
    }
    
    .reason-item {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-sm) var(--spacing-md);
        background: linear-gradient(135deg, #e8f5e8, #f1f8e9);
        border-radius: var(--spacing-xs);
        border-left: 4px solid #4caf50;
    }
    
    .reason-check {
        color: #4caf50;
        font-weight: 600;
        font-size: 1.1em;
    }
    
    .eligibility-score {
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: var(--spacing-sm);
        align-items: center;
        font-size: 0.95rem;
        margin-top: var(--spacing-md);
    }
    
    .score-label {
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .score-bar {
        height: 10px;
        background: var(--border-color);
        border-radius: 5px;
        overflow: hidden;
        position: relative;
    }
    
    .score-fill {
        height: 100%;
        background: var(--success-gradient);
        transition: width 2s ease;
        border-radius: 5px;
    }
    
    .score-value {
        font-weight: 700;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    /* Perfect Status Display */
    .debug-status {
        position: fixed;
        bottom: var(--spacing-lg);
        right: var(--spacing-lg);
        background: var(--dark-gradient);
        color: white;
        padding: var(--spacing-sm) var(--spacing-md);
        border-radius: var(--border-radius-small);
        font-size: 0.85rem;
        font-weight: 500;
        z-index: 10000;
        max-width: 320px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.25);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.1);
    }
    
    /* Perfect Chatbot Styles */
    .chatbot-fab {
        position: fixed;
        bottom: var(--spacing-lg);
        left: var(--spacing-lg);
        width: 64px;
        height: 64px;
        background: var(--primary-gradient);
        border: none;
        border-radius: 50%;
        color: white;
        font-size: 1.8rem;
        cursor: pointer;
        box-shadow: 0 8px 32px rgba(30, 60, 114, 0.25);
        transition: var(--transition);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .chatbot-fab:hover {
        transform: scale(1.05) translateY(-2px);
        box-shadow: 0 12px 40px rgba(30, 60, 114, 0.35);
    }
    
    .chatbot-container {
        position: fixed;
        bottom: 100px;
        left: var(--spacing-lg);
        width: 380px;
        max-height: 600px;
        background: var(--surface-gradient);
        border-radius: var(--border-radius);
        box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        z-index: 9998;
        transform: translateY(100%);
        opacity: 0;
        transition: var(--transition);
        overflow: hidden;
        border: 1px solid var(--border-color);
    }
    
    .chatbot-container.open {
        transform: translateY(0);
        opacity: 1;
    }
    
    .chatbot-header {
        background: var(--primary-gradient);
        color: white;
        padding: var(--spacing-lg);
        cursor: pointer;
        display: grid;
        grid-template-columns: 1fr auto;
        gap: var(--spacing-md);
        align-items: center;
    }
    
    .chatbot-title h4 {
        margin: 0 0 4px 0;
        font-size: 1.2rem;
        font-weight: 600;
    }
    
    .chatbot-status {
        font-size: 0.85rem;
        opacity: 0.9;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .status-dot {
        width: 8px;
        height: 8px;
        background: #4caf50;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    .chatbot-toggle {
        font-size: 1.3rem;
        transition: transform 0.3s ease;
    }
    
    .chatbot-container.open .chatbot-toggle {
        transform: rotate(180deg);
    }
    
    .chatbot-messages {
        height: 380px;
        overflow-y: auto;
        padding: var(--spacing-lg);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
    }
    
    .message {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: var(--spacing-sm);
        align-items: flex-start;
        animation: messageSlide 0.3s ease;
    }
    
    .user-message {
        grid-template-columns: 1fr auto;
    }
    
    @keyframes messageSlide {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .message-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        flex-shrink: 0;
    }
    
    .bot-message .message-avatar {
        background: var(--primary-gradient);
        color: white;
    }
    
    .user-message .message-avatar {
        background: var(--secondary-gradient);
        color: white;
        order: 2;
    }
    
    .message-content {
        background: var(--surface-gradient);
        padding: var(--spacing-md) var(--spacing-lg);
        border-radius: var(--border-radius);
        max-width: 280px;
        font-size: 0.95rem;
        line-height: 1.4;
        border: 1px solid var(--border-color);
    }
    
    .user-message .message-content {
        background: var(--secondary-gradient);
        color: white;
        border-color: transparent;
        justify-self: end;
    }
    
    .message-content p {
        margin: 0 0 var(--spacing-xs) 0;
    }
    
    .message-content p:last-child {
        margin-bottom: 0;
    }
    
    .suggestion-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: var(--spacing-xs);
        margin-top: var(--spacing-sm);
    }
    
    .suggestion-btn {
        background: var(--primary-gradient);
        color: white;
        border: none;
        padding: 6px var(--spacing-sm);
        border-radius: var(--spacing-md);
        font-size: 0.8rem;
        cursor: pointer;
        transition: var(--transition);
    }
    
    .suggestion-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(30, 60, 114, 0.25);
    }
    
    .chatbot-input {
        padding: var(--spacing-lg);
        border-top: 1px solid var(--border-color);
        display: grid;
        grid-template-columns: 1fr auto;
        gap: var(--spacing-sm);
        align-items: center;
        background: var(--surface-gradient);
    }
    
    .chatbot-input input {
        padding: var(--spacing-sm) var(--spacing-md);
        border: 1px solid var(--border-color);
        border-radius: 24px;
        font-size: 0.95rem;
        outline: none;
        transition: var(--transition);
    }
    
    .chatbot-input input:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .chatbot-send-btn {
        width: 44px;
        height: 44px;
        background: var(--primary-gradient);
        border: none;
        border-radius: 50%;
        color: white;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
    }
    
    .chatbot-send-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 16px rgba(30, 60, 114, 0.25);
    }
    
    /* Perfect Responsive Design */
    @media (max-width: 1400px) {
        .container {
            grid-template-columns: 1fr;
            gap: var(--spacing-md);
        }
        
        .sidebar {
            order: 2;
            position: static;
        }
        
        .map-container {
            height: 500px;
            order: 1;
        }
        
        .chatbot-container {
            width: 320px;
        }
    }
    
    @media (max-width: 768px) {
        .header h1 {
            font-size: 2rem;
        }
        
        .header p {
            font-size: 1rem;
        }
        
        .container {
            padding: var(--spacing-md);
            gap: var(--spacing-md);
        }
        
       .tab-content {
    padding: var(--spacing-md);
    max-height: calc(100vh - 240px);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}
        .chatbot-container {
            left: var(--spacing-md);
            right: var(--spacing-md);
            width: auto;
        }
        
        .chatbot-fab {
            left: var(--spacing-md);
            bottom: var(--spacing-md);
        }
        
        .debug-status {
            right: var(--spacing-md);
            bottom: var(--spacing-md);
        }
        
        .village-header {
            grid-template-columns: 1fr;
            text-align: center;
        }
        
        .scheme-header {
            grid-template-columns: 1fr;
            gap: var(--spacing-sm);
        }
        
        .eligibility-score {
            grid-template-columns: 1fr;
            gap: var(--spacing-xs);
            text-align: center;
        }
    }
    
    /* Perfect Custom Scrollbar */
    ::-webkit-scrollbar {
        width: 8px;
    }
    
    ::-webkit-scrollbar-track {
        background: var(--border-color);
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: var(--primary-gradient);
        border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: var(--secondary-gradient);
    }
    
    /* Perfect Animation Keyframes */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Perfect Focus States */
    button:focus-visible,
    input:focus-visible {
        outline: 2px solid #667eea;
        outline-offset: 2px;
    }
    
    /* Panel Styles */
    .panel {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 400px;
        max-height: 80vh;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        overflow: hidden;
    }
    
    .panel-header {
        background: linear-gradient(135deg, #1b5e20, #2e7d32);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .panel-header h3 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
    }
    
    .close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .panel-content {
        padding: 20px;
        max-height: calc(80vh - 60px);
        overflow-y: auto;
    }
    
    /* Breadcrumb Styles */
    .breadcrumb {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
    }
    
    .breadcrumb-item {
        padding: 6px 12px;
        background: #f5f5f5;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s ease;
    }
    
    .breadcrumb-item:hover {
        background: #e0e0e0;
    }
    
    .breadcrumb-item.active {
        background: #2e7d32;
        color: white;
    }
    
    /* Navigation Content */
    .navigation-content {
        max-height: 400px;
        overflow-y: auto;
    }
    
    .nav-item {
        padding: 12px 16px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        background: white;
    }
    
    .nav-item:hover {
        background: #f8f9fa;
        border-color: #2e7d32;
    }
    
    .nav-item-header {
        font-weight: 600;
        color: #1b5e20;
        margin-bottom: 4px;
    }
    
    .nav-item-stats {
        font-size: 12px;
        color: #666;
    }
    
    /* Search Form */
    .search-form {
        margin-bottom: 20px;
    }
    
    .search-form input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        margin-bottom: 12px;
    }
    
    .search-filters {
        display: flex;
        gap: 8px;
    }
    
    .search-filters select {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 12px;
    }
    
    /* Search Results */
    .search-results {
        max-height: 300px;
        overflow-y: auto;
    }
    
    .search-result-item {
        padding: 12px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .search-result-item:hover {
        background: #f8f9fa;
        border-color: #2e7d32;
    }
    
    .search-result-header {
        font-weight: 600;
        color: #1b5e20;
        margin-bottom: 4px;
    }
    
    .search-result-details {
        font-size: 12px;
        color: #666;
    }
    
    /* Filter Sections */
    .filter-section {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eee;
    }
    
    .filter-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    
    .filter-section h4 {
        margin: 0 0 10px 0;
        font-size: 14px;
        color: #1b5e20;
    }
    
    .filter-section label {
        display: block;
        margin-bottom: 8px;
        font-size: 13px;
        cursor: pointer;
    }
    
    .filter-section input[type="checkbox"] {
        margin-right: 8px;
    }
    
    .filter-section input[type="range"] {
        width: 100%;
        margin-bottom: 8px;
    }
    
    #area-value {
        font-size: 12px;
        color: #666;
    }
</style>

</head>
<body>
<div class="auth-header" style="background: var(--primary-gradient); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
    <div style="display: flex; align-items: center; gap: 15px;">
        <div style="font-size: 1.5rem;">
            {% if session.user_role == 'CCF' %}🏛️
            {% elif session.user_role == 'DCF' %}👔
            {% elif session.user_role == 'RFO' %}🌲
            {% elif session.user_role == 'GRAM_SABHA' %}🏘️
            {% else %}👤
            {% endif %}
        </div>
        <div>
            <div style="font-weight: 600;">{{ session.user_name }}</div>
            <div style="font-size: 0.9em; opacity: 0.9;">{{ session.user_role }} Access</div>
        </div>
    </div>
</div>

    <!-- Debug Status -->
    <div class="debug-status" id="debug-status">
        System: Initializing...
    </div>

    <!-- Top Navigation Bar -->
    <nav class="top-navbar">
        <div class="navbar-brand">
            <h1 id="dashboard-title">🛡️ FRA Sentinel</h1>
        </div>
        
        <div class="navbar-center">
            <div class="nav-features">
                <a href="{{ url_for('ai_predictions') }}" class="btn-unified btn-primary nav-btn ai-predictions">
                    <span class="nav-icon">🔮</span>
                    <span class="nav-text">AI Predictions</span>
                </a>
                <a href="{{ url_for('ai_chatbot') }}" class="btn-unified btn-primary nav-btn ai-chatbot">
                    <span class="nav-icon">🤖</span>
                    <span class="nav-text">AI Assistant</span>
                </a>
                <a href="{{ url_for('analytics') }}" class="btn-unified btn-primary nav-btn analytics">
                    <span class="nav-icon">📊</span>
                    <span class="nav-text">Analytics</span>
                </a>
                <a href="{{ url_for('reports') }}" class="btn-unified btn-primary nav-btn reports">
                    <span class="nav-icon">📈</span>
                    <span class="nav-text">Reports</span>
                </a>
            </div>
        </div>
        
        <div class="navbar-right">
            <!-- Language Switcher -->
            <div class="language-switcher">
                <select id="language-select" onchange="changeLanguage(this.value)">
                    <option value="english">🇺🇸 EN</option>
                    <option value="hindi">🇮🇳 हिं</option>
                    <option value="tamil">🇮🇳 தமி</option>
                    <option value="telugu">🇮🇳 తెలు</option>
                    <option value="kannada">🇮🇳 ಕನ್ನ</option>
                    <option value="malayalam">🇮🇳 മല</option>
                    <option value="odia">🇮🇳 ଓଡ଼ି</option>
                    <option value="bengali">🇮🇳 বাংলা</option>
                </select>
            </div>
            
            <!-- User Profile -->
            <div class="user-profile">
                <div class="profile-avatar">
                    <span class="avatar-icon">👤</span>
                </div>
                <div class="profile-info">
                    <span class="profile-name">{{ session.user_name }}</span>
                    <span class="profile-role">{{ session.user_role }}</span>
                </div>
            </div>
            
            <!-- Admin Dropdown -->
            {% if session.user_role in ['CCF', 'DCF', 'RFO'] %}
            <div class="admin-dropdown">
                <button class="admin-btn" onclick="toggleAdminDropdown()">
                    <span class="admin-icon">🛠️</span>
                    <span class="admin-text">Admin</span>
                    <span class="dropdown-arrow">▼</span>
                </button>
                <div class="admin-menu" id="admin-menu">
                    <a href="{{ url_for('admin_dashboard') }}" class="admin-item">
                        <span class="item-icon">📊</span>
                        <span class="item-text">Dashboard</span>
                    </a>
                    <a href="{{ url_for('admin_panel') }}" class="admin-item">
                        <span class="item-icon">📄</span>
                        <span class="item-text">Upload Document</span>
                    </a>
                    <div class="admin-divider"></div>
                    <a href="{{ url_for('logout') }}" class="admin-item logout-item">
                        <span class="item-icon">🚪</span>
                        <span class="item-text">Logout</span>
                    </a>
                </div>
            </div>
            {% else %}
            <a href="{{ url_for('logout') }}" class="logout-btn">
                <span class="logout-icon">🚪</span>
                <span class="logout-text">Logout</span>
            </a>
            {% endif %}
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Enhanced Sidebar -->
        <aside class="sidebar">
            <nav class="tab-navigation">
                <button class="tab-button active" data-tab="overview">
                    <span>📊</span> Overview
                </button>
                <button class="tab-button" data-tab="analytics">
                    <span>📈</span> Analytics
                </button>
                <button class="tab-button" data-tab="export">
                    <span>📥</span> Export
                </button>
            </nav>

            <div class="tab-content">
                <div id="overview" class="tab-pane active">
                    <div class="info-section">
                        <h3><span class="section-icon">🏘️</span> Village Information</h3>
                        <div id="village-info" class="loading">Loading village data...</div>
                    </div>

                    <div class="info-section">
                        <h3><span class="section-icon">📊</span> Land Use Statistics</h3>
                        <div id="land-stats" class="loading">Calculating statistics...</div>
                    </div>

                    <div class="info-section">
                        <h3><span class="section-icon">🎯</span> Smart Recommendations</h3>
                        <div id="recommendations" class="loading">Analyzing data...</div>
                    </div>
                </div>

                <div id="analytics" class="tab-pane">
                    <div class="info-section">
                        <h3><span class="section-icon">📈</span> System Analytics</h3>
                        <div id="system-analytics">
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>🟢</span> System Status
                                </span>
                                <span class="stat-value" id="system-status">Checking...</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>🏘️</span> Villages Loaded
                                </span>
                                <span class="stat-value" id="villages-count">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>📊</span> Data Categories
                                </span>
                                <span class="stat-value" id="stats-count">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="export" class="tab-pane">
                    <div class="info-section">
                        <h3><span class="section-icon">📥</span> Export Options</h3>
                        <div class="stat-item">
                            <span class="stat-label">
                                <span>📄</span> PDF Report
                            </span>
                            <button class="control-button">Generate</button>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">
                                <span>📊</span> Excel Data
                            </span>
                            <button class="control-button">Export</button>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Enhanced Map Container with Layer Controls -->
        <main class="map-container">
            <div class="map-controls">
                <div class="control-group">
                    <button class="control-button active" id="street-view" onclick="switchMapLayer('street')">
                        <span class="control-icon">🗺️</span> Street
                    </button>
                    <button class="control-button" id="satellite-view" onclick="switchMapLayer('satellite')">
                        <span class="control-icon">🛰️</span> Satellite
                    </button>
                    <button class="control-button" id="terrain-view" onclick="switchMapLayer('terrain')">
                        <span class="control-icon">🏔️</span> Terrain
                    </button>
                </div>
                
                <div class="control-group">
                    <button class="control-button" onclick="resetMapView()">
                        <span class="control-icon">🏠</span> Reset
                    </button>
                    <button class="control-button" onclick="toggleFullscreen()">
                        <span class="control-icon">⛶</span> Full
                    </button>
                </div>
                
                
                
                <div class="control-group">
                    <button class="control-button" onclick="showDrillDownPanel()">
                        <span class="control-icon">🔍</span> Drill Down
                    </button>
                    <button class="control-button" onclick="showSearchPanel()">
                        <span class="control-icon">🔎</span> Search
                    </button>
                    <button class="control-button" onclick="showFiltersPanel()">
                        <span class="control-icon">🎛️</span> Filters
                    </button>
                </div>
            </div>
            
            <div id="map"></div>
        </main>
        
        <!-- FRA Atlas Drill-down Panel -->
        <div id="drill-down-panel" class="panel" style="display: none;">
            <div class="panel-header">
                <h3>🗺️ FRA Atlas Navigation</h3>
                <button class="close-btn" onclick="hideDrillDownPanel()">×</button>
            </div>
            <div class="panel-content">
                <div id="navigation-breadcrumb" class="breadcrumb">
                    <span class="breadcrumb-item active" onclick="loadStates()">States</span>
                </div>
                <div id="navigation-content" class="navigation-content">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </div>
        
        <!-- Search Panel -->
        <div id="search-panel" class="panel" style="display: none;">
            <div class="panel-header">
                <h3>🔎 Search FRA Data</h3>
                <button class="close-btn" onclick="hideSearchPanel()">×</button>
            </div>
            <div class="panel-content">
                <div class="search-form">
                    <input type="text" id="search-input" placeholder="Search by patta holder, village, or tribal group..." 
                           onkeyup="performSearch()">
                    <div class="search-filters">
                        <select id="status-filter" onchange="performSearch()">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="verified">Verified</option>
                            <option value="approved">Approved</option>
                        </select>
                        <select id="type-filter" onchange="performSearch()">
                            <option value="all">All Types</option>
                            <option value="IFR">IFR</option>
                            <option value="CR">CR</option>
                            <option value="CFR">CFR</option>
                        </select>
                    </div>
                </div>
                <div id="search-results" class="search-results">
                    <!-- Search results will be displayed here -->
                </div>
            </div>
        </div>
        
        <!-- Filters Panel -->
        <div id="filters-panel" class="panel" style="display: none;">
            <div class="panel-header">
                <h3>🎛️ Map Filters</h3>
                <button class="close-btn" onclick="hideFiltersPanel()">×</button>
            </div>
            <div class="panel-content">
                <div class="filter-section">
                    <h4>FRA Claims Status</h4>
                    <label><input type="checkbox" checked onchange="updateClaimStatusFilter()"> Pending</label>
                    <label><input type="checkbox" checked onchange="updateClaimStatusFilter()"> Verified</label>
                    <label><input type="checkbox" checked onchange="updateClaimStatusFilter()"> Approved</label>
                </div>
                <div class="filter-section">
                    <h4>Claim Types</h4>
                    <label><input type="checkbox" checked onchange="updateClaimTypeFilter()"> IFR (Individual Forest Rights)</label>
                    <label><input type="checkbox" checked onchange="updateClaimTypeFilter()"> CR (Community Rights)</label>
                    <label><input type="checkbox" checked onchange="updateClaimTypeFilter()"> CFR (Community Forest Resource)</label>
                </div>
                <div class="filter-section">
                    <h4>Tribal Groups</h4>
                    <label><input type="checkbox" checked onchange="updateTribalGroupFilter()"> Bhil</label>
                    <label><input type="checkbox" checked onchange="updateTribalGroupFilter()"> Gond</label>
                    <label><input type="checkbox" checked onchange="updateTribalGroupFilter()"> Baiga</label>
                </div>
                <div class="filter-section">
                    <h4>Area Range (Hectares)</h4>
                    <input type="range" id="area-range" min="0" max="10" value="10" onchange="updateAreaFilter()">
                    <span id="area-value">0-10 hectares</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Chatbot Interface -->
    <div class="chatbot-container" id="chatbot-container">
        <div class="chatbot-header" onclick="toggleChatbot()">
            <div class="chatbot-title">
                <h4>🤖 FRA Assistant</h4>
                <div class="chatbot-status">
                    <span class="status-dot"></span>
                    <span>Online & Ready</span>
                </div>
            </div>
            <div class="chatbot-toggle" id="chatbot-toggle">▼</div>
        </div>
        
        <div class="chatbot-messages" id="chatbot-messages">
            <div class="message bot-message">
                <div class="message-avatar">🤖</div>
                <div class="message-content">
                    <p>Welcome to FRA Atlas! I'm your intelligent assistant for Forest Rights Act queries.</p>
                    <p>I can help you with:</p>
                    <ul style="margin: 8px 0; padding-left: 20px;">
                        <li>FRA information & eligibility</li>
                        <li>Government scheme recommendations</li>
                        <li>Village data analysis</li>
                        <li>Land use classification details</li>
                    </ul>
                    <div class="suggestion-buttons">
                        <button class="suggestion-btn" onclick="sendSuggestion('Tell me about FRA')">About FRA</button>
                        <button class="suggestion-btn" onclick="sendSuggestion('What schemes are available?')">Available Schemes</button>
                        <button class="suggestion-btn" onclick="sendSuggestion('Show village analysis')">Village Analysis</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="chatbot-input">
            <input type="text" id="chatbot-input" placeholder="Ask me about FRA, schemes, or village data..." />
            <button class="chatbot-send-btn" onclick="sendMessage()">
                <span>📤</span>
            </button>
        </div>
    </div>

    <!-- Chatbot Toggle Button -->
    <button class="chatbot-fab" onclick="toggleChatbot()" title="FRA Assistant">
        🤖
    </button>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        console.log('🚀 FRA Atlas Ultimate Starting...');
        
        // Language switching functionality
        let currentLanguage = 'english';
        let translations = {};
        
        async function changeLanguage(language) {
            currentLanguage = language;
            try {
                const response = await fetch(`/api/translations/${language}`);
                translations = await response.json();
                updateUI();
                console.log(`🌐 Language changed to: ${language}`);
            } catch (error) {
                console.error('❌ Failed to load translations:', error);
            }
        }
        
        function updateUI() {
            // Update dashboard title
            const titleElement = document.getElementById('dashboard-title');
            if (titleElement && translations.dashboard_title) {
                titleElement.textContent = `🛡️ ${translations.dashboard_title}`;
            }
            
            // Update subtitle
            const subtitleElement = document.getElementById('dashboard-subtitle');
            if (subtitleElement && translations.dashboard_subtitle) {
                subtitleElement.textContent = translations.dashboard_subtitle;
            }
            
            // Update admin link
            const adminLink = document.getElementById('admin-link');
            if (adminLink && translations.admin) {
                adminLink.innerHTML = `🛠️ ${translations.admin}`;
            }
            
            // Update logout link
            const logoutLink = document.getElementById('logout-link');
            if (logoutLink && translations.logout) {
                logoutLink.innerHTML = `🚪 ${translations.logout}`;
            }
            
            // Update control buttons
            const statesBtn = document.getElementById('states-layer');
            if (statesBtn && translations.states) {
                statesBtn.innerHTML = `<span class="control-icon">🗺️</span> ${translations.states}`;
            }
            
            const districtsBtn = document.getElementById('districts-layer');
            if (districtsBtn && translations.districts) {
                districtsBtn.innerHTML = `<span class="control-icon">🏛️</span> ${translations.districts}`;
            }
            
            const villagesBtn = document.getElementById('villages-layer');
            if (villagesBtn && translations.villages) {
                villagesBtn.innerHTML = `<span class="control-icon">🏘️</span> ${translations.villages}`;
            }
            
            const tribalBtn = document.getElementById('tribal-layer');
            if (tribalBtn && translations.tribal_areas) {
                tribalBtn.innerHTML = `<span class="control-icon">👥</span> ${translations.tribal_areas}`;
            }
        }
        
        // Initialize language on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Set default language from session or use English
            const savedLanguage = '{{ session.language or "english" }}';
            if (savedLanguage && savedLanguage !== 'english') {
                document.getElementById('language-select').value = savedLanguage;
                changeLanguage(savedLanguage);
            }
        });

        // Admin dropdown functionality
        function toggleAdminDropdown() {
            const menu = document.getElementById('admin-menu');
            const arrow = document.querySelector('.dropdown-arrow');
            
            if (menu.classList.contains('show')) {
                menu.classList.remove('show');
                arrow.style.transform = 'rotate(0deg)';
            } else {
                menu.classList.add('show');
                arrow.style.transform = 'rotate(180deg)';
            }
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.querySelector('.admin-dropdown');
            if (dropdown && !dropdown.contains(event.target)) {
                const menu = document.getElementById('admin-menu');
                const arrow = document.querySelector('.dropdown-arrow');
                menu.classList.remove('show');
                arrow.style.transform = 'rotate(0deg)';
            }
        });

        // AI Features
        function showAIPredictions() {
            alert('🔮 AI Predictions Panel\n\n• Forest Health Forecast\n• Deforestation Risk Analysis\n• Tribal Settlement Growth\n• Climate Impact Predictions\n• Resource Availability Trends');
        }

        function openChatbot() {
            alert('🤖 AI Assistant\n\nWelcome to FRA Sentinel AI Assistant!\n\nI can help you with:\n• FRA claim information\n• Forest rights queries\n• Data analysis\n• Report generation\n• System guidance');
        }

        function showAnalytics() {
            alert('📊 Advanced Analytics\n\n• Real-time Data Visualization\n• Interactive Charts & Graphs\n• Trend Analysis\n• Performance Metrics\n• Custom Reports');
        }

        function generateReports() {
            alert('📈 Report Generation\n\n• Automated FRA Reports\n• Custom Analytics\n• Export Options (PDF, Excel)\n• Scheduled Reports\n• Data Insights');
        }
        
        class FRAAtlas {
            constructor() {
                this.map = null;
                this.fraLayer = null;
                this.currentMapLayer = null;
                this.mapLayers = {};
                this.init();
            }

            init() {
                console.log('🔧 Initializing FRA Atlas Ultimate...');
                this.updateDebugStatus('Initializing...');
                this.initMap();
                this.initTabs();
                this.loadSystemData();
            }

            updateDebugStatus(message) {
                const debugEl = document.getElementById('debug-status');
                if (debugEl) {
                    debugEl.textContent = `System: ${message}`;
                }
                console.log('🔄 Status:', message);
            }

            initMap() {
                console.log('🗺️ Initializing enhanced map...');
                
                this.map = L.map('map', {
                    center: [21.8225, 75.6102],
                    zoom: 10,
                    zoomControl: false
                });
                
                // Add zoom control
                L.control.zoom({
                    position: 'bottomright'
                }).addTo(this.map);
                
                // Define map layers
                this.mapLayers = {
                    street: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenStreetMap contributors',
                        maxZoom: 18
                    }),
                    satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                        attribution: '© Esri, DigitalGlobe, GeoEye',
                        maxZoom: 18
                    }),
                    terrain: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                        attribution: '© OpenTopoMap contributors',
                        maxZoom: 15
                    })
                };
                
                // Add default street layer
                this.currentMapLayer = this.mapLayers.street;
                this.currentMapLayer.addTo(this.map);
                
                console.log('✅ Enhanced map initialized with multiple layers');
                this.updateDebugStatus('Map Ready with Layer Controls');
            }

            initTabs() {
                const tabButtons = document.querySelectorAll('.tab-button');
                const tabPanes = document.querySelectorAll('.tab-pane');

                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        const target = button.getAttribute('data-tab');
                        
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        
                        tabPanes.forEach(pane => pane.classList.remove('active'));
                        document.getElementById(target).classList.add('active');
                        
                        console.log('📑 Switched to tab:', target);
                    });
                });
            }

            async loadSystemData() {
                console.log('📊 Loading system data...');
                this.updateDebugStatus('Loading Data...');
                
                try {
                    // Load system status
                    const statusResponse = await fetch('/api/system_status');
                    if (!statusResponse.ok) throw new Error(`Status API failed: ${statusResponse.status}`);
                    const statusData = await statusResponse.json();
                    console.log('✅ System status loaded:', statusData);
                    this.updateSystemStatus(statusData);
                    
                    // Load FRA data
                    const fraResponse = await fetch('/api/fra_data');
                    if (!fraResponse.ok) throw new Error(`FRA API failed: ${fraResponse.status}`);
                    const fraData = await fraResponse.json();
                    if (fraData.error) throw new Error(fraData.error);
                    console.log('✅ FRA data loaded:', fraData);
                    this.displayFRAData(fraData);
                    
                    // Load statistics
                    const statsResponse = await fetch('/api/classification_stats');
                    if (!statsResponse.ok) throw new Error(`Stats API failed: ${statsResponse.status}`);
                    const statsData = await statsResponse.json();
                    console.log('✅ Statistics loaded:', statsData);
                    this.displayStatistics(statsData);
                    
                    this.updateDebugStatus('✅ All Data Loaded Successfully');
                    
                    // Auto-select first village
                    if (fraData.features && fraData.features.length > 0) {
                        setTimeout(() => {
                            console.log('🎯 Auto-selecting first village...');
                            this.selectVillage(fraData.features[0].properties);
                        }, 1000);
                    }
                    
                } catch (error) {
                    console.error('💥 Error loading data:', error);
                    this.updateDebugStatus('❌ Error: ' + error.message);
                }
            }

            updateSystemStatus(statusData) {
                document.getElementById('system-status').textContent = statusData.status || 'Unknown';
                document.getElementById('villages-count').textContent = statusData.villages_loaded || 0;
                document.getElementById('stats-count').textContent = statusData.stats_loaded || 0;
            }

            displayFRAData(data) {
                console.log('🏘️ Displaying FRA data with enhanced markers...');
                
                if (!data.features || data.features.length === 0) {
                    console.error('❌ No villages found');
                    return;
                }

                if (this.fraLayer) {
                    this.map.removeLayer(this.fraLayer);
                }

                this.fraLayer = L.geoJSON(data, {
                    pointToLayer: (feature, latlng) => {
                        return L.circleMarker(latlng, {
                            radius: 16,
                            fillColor: "#1e3c72",
                            color: "#ffffff",
                            weight: 4,
                            opacity: 1,
                            fillOpacity: 0.9
                        });
                    },
                    onEachFeature: (feature, layer) => {
                        const props = feature.properties;
                        
                        const popupContent = `
                            <div style="font-family: 'Inter', sans-serif; padding: 20px; min-width: 280px; background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); border-radius: 12px;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #1e3c72, #2a5298); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5em; color: white; box-shadow: 0 4px 15px rgba(30, 60, 114, 0.3);">🏘️</div>
                                    <div>
                                        <h4 style="margin: 0; background: linear-gradient(135deg, #1e3c72, #4a7c59); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 1.4em;">${props.village}</h4>
                                        <p style="margin: 4px 0 0 0; color: #666; font-size: 0.95em;">Forest Rights Village</p>
                                    </div>
                                </div>
                                
                                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 16px; border-radius: 10px; margin: 15px 0;">
                                    <p style="margin: 6px 0; color: #333;"><strong>🧑‍🌾 Patta Holder:</strong> ${props.patta_holder}</p>
                                    <p style="margin: 6px 0; color: #333;"><strong>📏 Land Area:</strong> ${props.area_hectares} hectares</p>
                                    <p style="margin: 6px 0; color: #333;"><strong>✅ Status:</strong> <span style="color: #28a745; font-weight: 600;">${props.claim_status}</span></p>
                                    <p style="margin: 6px 0; color: #333;"><strong>📍 Location:</strong> ${props.latitude.toFixed(4)}, ${props.longitude.toFixed(4)}</p>
                                    ${props.tribal_group ? `<p style="margin: 6px 0; color: #333;"><strong>🏛️ Tribal Group:</strong> ${props.tribal_group}</p>` : ''}
                                    ${props.family_size ? `<p style="margin: 6px 0; color: #333;"><strong>👥 Family Size:</strong> ${props.family_size} members</p>` : ''}
                                    ${props.file_id ? `<p style="margin: 6px 0; color: #333;"><strong>📄 File ID:</strong> ${props.file_id}</p>` : ''}
                                    ${props.uploaded_by ? `<p style="margin: 6px 0; color: #333;"><strong>👤 Uploaded by:</strong> ${props.uploaded_by}</p>` : ''}
                                </div>
                                
                                <button onclick="window.fraAtlas.selectVillage(${JSON.stringify(props).replace(/"/g, '&quot;')})" 
                                        style="background: linear-gradient(135deg, #1e3c72, #4a7c59); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1em; font-weight: 500; transition: all 0.3s ease;">
                                    📊 View Detailed Analysis
                                </button>
                            </div>
                        `;
                        
                        layer.bindPopup(popupContent, {
                            maxWidth: 320,
                            className: 'custom-popup'
                        });
                        
                        layer.on('click', () => {
                            console.log('🔍 Village clicked:', props.village);
                            this.selectVillage(props);
                        });
                        
                        // Enhanced hover effects
                        layer.on('mouseover', function() {
                            this.setStyle({ fillOpacity: 1, radius: 20 });
                        });
                        
                        layer.on('mouseout', function() {
                            this.setStyle({ fillOpacity: 0.9, radius: 16 });
                        });
                    }
                });
                
                this.fraLayer.addTo(this.map);
                this.map.fitBounds(this.fraLayer.getBounds(), { padding: [40, 40] });
                
                console.log(`✅ Displayed ${data.features.length} villages with enhanced styling`);
            }

           displayStatistics(stats) {
    console.log('📈 Displaying enhanced statistics...');
    
    const container = document.getElementById('land-stats');
    if (!container) return;
    
    const icons = {
        'farmland': '🌾',
        'forest': '🌲', 
        'water': '💧',
        'homestead': '🏠'
    };

    let html = '<div class="stats-grid">';
    Object.entries(stats).forEach(([type, data], index) => {
        const icon = icons[type] || '📊';
        html += `
            <div class="stat-item" style="animation: slideUp 0.5s ease ${index * 0.1}s both;">
                <div class="stat-label">
                    <span class="stat-icon">${icon}</span>
                    <span>${type.charAt(0).toUpperCase() + type.slice(1)}</span>
                </div>
                <div class="stat-value-container">
                    <div class="stat-value">${data.percentage}%</div>
                    <div class="stat-subtext">${data.pixels.toLocaleString()} pixels</div>
                </div>
            </div>
        `;
    });
    html += '</div>';
    
    container.innerHTML = html;
    console.log('✅ Perfect statistics displayed');
}


            async selectVillage(props) {
                console.log('🎯 Selecting village with enhanced display:', props);
                
                const villageName = props.village;
                this.updateDebugStatus(`Analyzing ${villageName}...`);
                
                // Enhanced village info display
                const villageContainer = document.getElementById('village-info');
                villageContainer.innerHTML = `
                    <div class="village-card">
                        <div class="village-header">
                            <div class="village-avatar">🏘️</div>
                            <div class="village-details">
                                <h3>${villageName}</h3>
                                <p>Forest Rights Village • ${props.claim_status}</p>
                            </div>
                        </div>
                        
                        <div style="display: grid; gap: 14px;">
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>👤</span> Patta Holder
                                </span>
                                <span class="stat-value">${props.patta_holder}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>📏</span> Land Area
                                </span>
                                <span class="stat-value">${props.area_hectares} ha</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>✅</span> Claim Status
                                </span>
                                <span class="stat-value" style="color: #28a745;">${props.claim_status}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">
                                    <span>📍</span> Coordinates
                                </span>
                                <span class="stat-value">${props.latitude.toFixed(4)}, ${props.longitude.toFixed(4)}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Load recommendations
                try {
                    console.log('🔄 Loading enhanced recommendations...');
                    document.getElementById('recommendations').innerHTML = '<div class="loading">Loading recommendations...</div>';
                    
                    const encodedVillage = encodeURIComponent(villageName);
                    const recResponse = await fetch(`/api/dss_recommendation/${encodedVillage}`);
                    if (!recResponse.ok) throw new Error(`API failed: ${recResponse.status}`);
                    
                    const recData = await recResponse.json();
                    if (recData.error) throw new Error(recData.error);
                    
                    console.log('✅ Enhanced recommendations loaded:', recData);
                    this.displayRecommendations(recData);
                    this.updateDebugStatus(`✅ ${villageName} Analysis Complete`);
                    
                } catch (error) {
                    console.error('💥 Error loading recommendations:', error);
                    document.getElementById('recommendations').innerHTML = `
                        <div style="background: linear-gradient(135deg, #f8d7da, #f1aeb5); color: #721c24; padding: 20px; border-radius: 12px; border-left: 4px solid #dc3545;">
                            <strong>❌ Failed to load recommendations:</strong><br>
                            ${error.message}
                        </div>
                    `;
                }
            }

            displayRecommendations(data) {
                console.log('🎯 Displaying enhanced recommendations...');
                
                const container = document.getElementById('recommendations');
                
                if (!data.recommendations || data.recommendations.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 50px; background: var(--card-gradient); border-radius: var(--border-radius);">
                            <div style="font-size: 4em; margin-bottom: 20px;">🎯</div>
                            <h4 style="background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 12px;">All Schemes Optimized</h4>
                            <p style="color: var(--text-secondary);">Current scheme distribution is optimal for this village.</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                data.recommendations.forEach((rec, index) => {
                    const priorityIcons = { 'High': '🔥', 'Medium': '⚡', 'Low': '📝' };
                    const priorityIcon = priorityIcons[rec.priority] || '📋';
                    
                    html += `
                        <div class="recommendation-item" style="animation-delay: ${index * 0.15}s;">
                            <div class="scheme-header">
                                <div class="scheme-name">
                                    <span class="scheme-icon">${priorityIcon}</span>
                                    <span>${rec.scheme}</span>
                                </div>
                                <span class="priority priority-${rec.priority.toLowerCase()}">${rec.priority} Priority</span>
                            </div>
                            
                            <div style="margin: 20px 0; color: var(--text-secondary); line-height: 1.6;">
                                <p style="margin: 10px 0;"><strong style="color: var(--text-primary);">💰 Benefit:</strong> ${rec.benefit}</p>
                                <p style="margin: 10px 0;"><strong style="color: var(--text-primary);">🏛️ Ministry:</strong> ${rec.ministry}</p>
                                
                                <div style="margin: 20px 0;">
                                    <strong style="color: var(--text-primary);">✓ Eligibility Reasons:</strong>
                                    <div style="margin-top: 12px;">
                                        ${rec.reasons.map(reason => `
                                            <div style="display: flex; align-items: center; gap: 12px; margin: 8px 0; padding: 12px 16px; background: var(--success-gradient); background: linear-gradient(135deg, #e8f5e8, #f1f8e9); border-radius: 8px; border-left: 4px solid #4caf50;">
                                                <span style="color: #4caf50; font-weight: 600;">✓</span>
                                                <span style="color: var(--text-primary);">${reason}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div style="display: flex; align-items: center; gap: 12px; margin-top: 20px; font-size: 0.95em;">
                                    <span style="font-weight: 600; color: var(--text-primary);">Eligibility Score:</span>
                                    <div style="flex: 1; height: 10px; background: var(--border-color); border-radius: 5px; overflow: hidden;">
                                        <div style="height: 100%; background: var(--success-gradient); width: ${rec.eligibility_score}%; transition: width 2s ease; border-radius: 5px;"></div>
                                    </div>
                                    <span style="font-weight: 700; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${rec.eligibility_score.toFixed(1)}/100</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                console.log(`✅ Displayed ${data.recommendations.length} enhanced recommendations`);
            }
        }

        // Global functions for map controls
        function switchMapLayer(layerType) {
            console.log('🗺️ Switching to', layerType, 'layer');
            
            if (window.fraAtlas && window.fraAtlas.currentMapLayer) {
                window.fraAtlas.map.removeLayer(window.fraAtlas.currentMapLayer);
            }
            
            window.fraAtlas.currentMapLayer = window.fraAtlas.mapLayers[layerType];
            window.fraAtlas.currentMapLayer.addTo(window.fraAtlas.map);
            
            // Update button states
            document.querySelectorAll('#street-view, #satellite-view, #terrain-view').forEach(btn => btn.classList.remove('active'));
            document.getElementById(layerType + '-view').classList.add('active');
            
            window.fraAtlas.updateDebugStatus(`Map: ${layerType.charAt(0).toUpperCase() + layerType.slice(1)} View Active`);
        }

        function resetMapView() {
            if (window.fraAtlas && window.fraAtlas.map) {
                window.fraAtlas.map.setView([21.8225, 75.6102], 10);
                console.log('🏠 Map view reset to default');
            }
        }

        function toggleFullscreen() {
            const mapContainer = document.querySelector('.map-container');
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                mapContainer.requestFullscreen();
            }
        }

        // Boundary layer management
        let boundaryLayers = {};
        
        async function toggleBoundaryLayer(layerType) {
            const button = document.getElementById(layerType + '-layer');
            const isActive = button.classList.contains('active');
            
            if (isActive) {
                // Remove layer
                if (boundaryLayers[layerType]) {
                    window.fraAtlas.map.removeLayer(boundaryLayers[layerType]);
                    delete boundaryLayers[layerType];
                }
                button.classList.remove('active');
            } else {
                // Add layer
                try {
                    const response = await fetch(`/api/boundaries/${layerType}`);
                    const data = await response.json();
                    
                    const layer = L.geoJSON(data, {
                        style: getBoundaryStyle(layerType),
                        onEachFeature: function(feature, layer) {
                            const props = feature.properties;
                            const popupContent = `
                                <div style="font-family: 'Inter', sans-serif; padding: 15px; min-width: 200px;">
                                    <h4 style="margin: 0 0 10px 0; color: #1b5e20;">${props.name}</h4>
                                    <p style="margin: 5px 0; color: #333;"><strong>Type:</strong> ${props.type}</p>
                                    ${props.state ? `<p style="margin: 5px 0; color: #333;"><strong>State:</strong> ${props.state}</p>` : ''}
                                    ${props.tribe ? `<p style="margin: 5px 0; color: #333;"><strong>Tribe:</strong> ${props.tribe}</p>` : ''}
                                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">
                                        <small style="color: #666;">Click to highlight • Hover for details</small>
                                    </div>
                                </div>
                            `;
                            layer.bindPopup(popupContent);
                            
                            // Add hover effects
                            layer.on('mouseover', function(e) {
                                this.setStyle(getHighlightStyle(layerType));
                                this.bringToFront();
                            });
                            
                            layer.on('mouseout', function(e) {
                                this.setStyle(getBoundaryStyle(layerType));
                            });
                            
                            // Add click-to-highlight functionality
                            layer.on('click', function(e) {
                                // Remove highlight from all other features in this layer
                                layer.eachLayer(function(layer) {
                                    layer.setStyle(getBoundaryStyle(layerType));
                                });
                                
                                // Highlight clicked feature
                                this.setStyle(getHighlightStyle(layerType));
                                this.bringToFront();
                                
                                // Show popup
                                this.openPopup();
                                
                                console.log(`🎯 Highlighted ${props.name} (${props.type})`);
                            });
                        }
                    });
                    
                    layer.addTo(window.fraAtlas.map);
                    boundaryLayers[layerType] = layer;
                    button.classList.add('active');
                    
                    console.log(`✅ ${layerType} boundary layer loaded`);
                } catch (error) {
                    console.error(`❌ Failed to load ${layerType} layer:`, error);
                }
            }
        }
        
        function getBoundaryStyle(layerType) {
            const styles = {
                'states': {
                    color: '#1E3A8A',  // Dark Blue
                    weight: 3,
                    opacity: 0.8,
                    fillColor: '#1E3A8A',
                    fillOpacity: 0.2,
                    dashArray: '10, 5'
                },
                'districts': {
                    color: '#F97316',  // Orange
                    weight: 2,
                    opacity: 0.7,
                    fillColor: '#F97316',
                    fillOpacity: 0.15,
                    dashArray: '8, 4'
                },
                'villages': {
                    color: '#10B981',  // Light Green
                    weight: 1.5,
                    opacity: 0.6,
                    fillColor: '#10B981',
                    fillOpacity: 0.2,
                    dashArray: '5, 3'
                },
                'tribal_areas': {
                    color: '#DC2626',  // Red
                    weight: 2.5,
                    opacity: 0.8,
                    fillColor: '#DC2626',
                    fillOpacity: 0.25,
                    dashArray: '12, 6'
                }
            };
            return styles[layerType] || styles['states'];
        }
        
        function getHighlightStyle(layerType) {
            const styles = {
                'states': {
                    color: '#1E3A8A',
                    weight: 4,
                    opacity: 1,
                    fillColor: '#1E3A8A',
                    fillOpacity: 0.4
                },
                'districts': {
                    color: '#F97316',
                    weight: 3,
                    opacity: 1,
                    fillColor: '#F97316',
                    fillOpacity: 0.3
                },
                'villages': {
                    color: '#10B981',
                    weight: 2.5,
                    opacity: 1,
                    fillColor: '#10B981',
                    fillOpacity: 0.4
                },
                'tribal_areas': {
                    color: '#DC2626',
                    weight: 3.5,
                    opacity: 1,
                    fillColor: '#DC2626',
                    fillOpacity: 0.5
                }
            };
            return styles[layerType] || styles['states'];
        }

        // FRA Atlas Layer Management
        let fraLayers = {};
        
        async function toggleFRALayer(layerType) {
            const button = document.getElementById(layerType + '-layer');
            const isActive = button.classList.contains('active');
            
            if (isActive) {
                // Remove layer
                if (fraLayers[layerType]) {
                    window.fraAtlas.map.removeLayer(fraLayers[layerType]);
                    delete fraLayers[layerType];
                }
                button.classList.remove('active');
            } else {
                // Add FRA layer
                try {
                    const layer = await createFRALayer(layerType);
                    layer.addTo(window.fraAtlas.map);
                    fraLayers[layerType] = layer;
                    button.classList.add('active');
                    
                    console.log(`✅ ${layerType} FRA layer loaded`);
                } catch (error) {
                    console.error(`❌ Failed to load ${layerType} FRA layer:`, error);
                }
            }
        }
        
        async function createFRALayer(layerType) {
            const layerStyles = {
                'claims': {
                    color: '#FF6B35',
                    weight: 2,
                    opacity: 0.8,
                    fillColor: '#FF6B35',
                    fillOpacity: 0.3,
                    radius: 8
                },
                'forest': {
                    color: '#228B22',
                    weight: 1,
                    opacity: 0.6,
                    fillColor: '#228B22',
                    fillOpacity: 0.4
                },
                'water': {
                    color: '#4169E1',
                    weight: 1,
                    opacity: 0.7,
                    fillColor: '#4169E1',
                    fillOpacity: 0.5
                },
                'agricultural': {
                    color: '#FFD700',
                    weight: 1,
                    opacity: 0.6,
                    fillColor: '#FFD700',
                    fillOpacity: 0.3
                }
            };
            
            const style = layerStyles[layerType];
            const layerGroup = L.layerGroup();
            
            // Load FRA data and create markers/polygons
            const response = await fetch('/api/fra-atlas/states');
            const data = await response.json();
            
            for (const state of data.states) {
                // Create markers for each state with FRA data
                const marker = L.circleMarker([21.8225, 75.6102], {
                    ...style,
                    popup: `${state.name}: ${state.total_pattas} pattas, ${state.total_area_hectares} hectares`
                });
                
                marker.bindPopup(`
                    <div style="font-family: 'Inter', sans-serif; padding: 15px; min-width: 200px;">
                        <h4 style="margin: 0 0 10px 0; color: #1b5e20;">${state.name}</h4>
                        <p style="margin: 5px 0; color: #333;"><strong>Districts:</strong> ${state.districts_count}</p>
                        <p style="margin: 5px 0; color: #333;"><strong>Total Pattas:</strong> ${state.total_pattas}</p>
                        <p style="margin: 5px 0; color: #333;"><strong>Total Area:</strong> ${state.total_area_hectares} hectares</p>
                        <p style="margin: 5px 0; color: #333;"><strong>Forest Cover:</strong> ${state.avg_forest_cover}%</p>
                    </div>
                `);
                
                layerGroup.addLayer(marker);
            }
            
            return layerGroup;
        }

        // Panel Management Functions
        function showDrillDownPanel() {
            hideAllPanels();
            document.getElementById('drill-down-panel').style.display = 'block';
            loadStates();
        }
        
        function hideDrillDownPanel() {
            document.getElementById('drill-down-panel').style.display = 'none';
        }
        
        function showSearchPanel() {
            hideAllPanels();
            document.getElementById('search-panel').style.display = 'block';
        }
        
        function hideSearchPanel() {
            document.getElementById('search-panel').style.display = 'none';
        }
        
        function showFiltersPanel() {
            hideAllPanels();
            document.getElementById('filters-panel').style.display = 'block';
        }
        
        function hideFiltersPanel() {
            document.getElementById('filters-panel').style.display = 'none';
        }
        
        function hideAllPanels() {
            document.getElementById('drill-down-panel').style.display = 'none';
            document.getElementById('search-panel').style.display = 'none';
            document.getElementById('filters-panel').style.display = 'none';
        }

        // Drill-down Navigation Functions
        async function loadStates() {
            try {
                const response = await fetch('/api/fra-atlas/states');
                const data = await response.json();
                
                const content = document.getElementById('navigation-content');
                content.innerHTML = '';
                
                for (const state of data.states) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.onclick = () => loadDistricts(state.name);
                    item.innerHTML = `
                        <div class="nav-item-header">${state.name}</div>
                        <div class="nav-item-stats">
                            ${state.districts_count} districts • ${state.total_pattas} pattas • ${state.total_area_hectares} hectares
                        </div>
                    `;
                    content.appendChild(item);
                }
                
                updateBreadcrumb(['States']);
            } catch (error) {
                console.error('Failed to load states:', error);
            }
        }
        
        async function loadDistricts(stateName) {
            try {
                const response = await fetch(`/api/fra-atlas/states/${encodeURIComponent(stateName)}/districts`);
                const data = await response.json();
                
                const content = document.getElementById('navigation-content');
                content.innerHTML = '';
                
                for (const district of data.districts) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.onclick = () => loadBlocks(stateName, district.name);
                    item.innerHTML = `
                        <div class="nav-item-header">${district.name}</div>
                        <div class="nav-item-stats">
                            ${district.blocks_count} blocks • ${district.total_pattas} pattas • ${district.total_area_hectares} hectares
                        </div>
                    `;
                    content.appendChild(item);
                }
                
                updateBreadcrumb(['States', stateName]);
            } catch (error) {
                console.error('Failed to load districts:', error);
            }
        }
        
        async function loadBlocks(stateName, districtName) {
            try {
                const response = await fetch(`/api/fra-atlas/states/${encodeURIComponent(stateName)}/districts/${encodeURIComponent(districtName)}/blocks`);
                const data = await response.json();
                
                const content = document.getElementById('navigation-content');
                content.innerHTML = '';
                
                for (const block of data.blocks) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.onclick = () => loadVillages(stateName, districtName, block.name);
                    item.innerHTML = `
                        <div class="nav-item-header">${block.name}</div>
                        <div class="nav-item-stats">
                            ${block.villages_count} villages • ${block.total_pattas} pattas • ${block.total_area_hectares} hectares
                        </div>
                    `;
                    content.appendChild(item);
                }
                
                updateBreadcrumb(['States', stateName, districtName]);
            } catch (error) {
                console.error('Failed to load blocks:', error);
            }
        }
        
        async function loadVillages(stateName, districtName, blockName) {
            try {
                const response = await fetch(`/api/fra-atlas/states/${encodeURIComponent(stateName)}/districts/${encodeURIComponent(districtName)}/blocks/${encodeURIComponent(blockName)}/villages`);
                const data = await response.json();
                
                const content = document.getElementById('navigation-content');
                content.innerHTML = '';
                
                for (const village of data.villages) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.onclick = () => loadPattaHolders(stateName, districtName, blockName, village.name);
                    item.innerHTML = `
                        <div class="nav-item-header">${village.name}</div>
                        <div class="nav-item-stats">
                            ${village.patta_holders_count} patta holders • ${village.total_area_hectares} hectares
                            <br>Forest: ${village.forest_cover_percent}% • Water: ${village.water_bodies_count} bodies
                        </div>
                    `;
                    content.appendChild(item);
                }
                
                updateBreadcrumb(['States', stateName, districtName, blockName]);
            } catch (error) {
                console.error('Failed to load villages:', error);
            }
        }
        
        async function loadPattaHolders(stateName, districtName, blockName, villageName) {
            try {
                const response = await fetch(`/api/fra-atlas/states/${encodeURIComponent(stateName)}/districts/${encodeURIComponent(districtName)}/blocks/${encodeURIComponent(blockName)}/villages/${encodeURIComponent(villageName)}/patta-holders`);
                const data = await response.json();
                
                const content = document.getElementById('navigation-content');
                content.innerHTML = '';
                
                for (const patta of data.patta_holders) {
                    const item = document.createElement('div');
                    item.className = 'nav-item';
                    item.innerHTML = `
                        <div class="nav-item-header">${patta.name}</div>
                        <div class="nav-item-stats">
                            ${patta.tribal_group} • ${patta.claim_type} • ${patta.area_hectares} hectares
                            <br>Status: ${patta.status} • Literacy: ${patta.socio_economic.literacy}
                        </div>
                    `;
                    content.appendChild(item);
                }
                
                updateBreadcrumb(['States', stateName, districtName, blockName, villageName]);
            } catch (error) {
                console.error('Failed to load patta holders:', error);
            }
        }
        
        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('navigation-breadcrumb');
            breadcrumb.innerHTML = '';
            
            for (let i = 0; i < path.length; i++) {
                const item = document.createElement('span');
                item.className = 'breadcrumb-item';
                if (i === path.length - 1) item.classList.add('active');
                
                const pathArray = path.slice(0, i + 1);
                item.onclick = () => {
                    if (pathArray.length === 1) loadStates();
                    else if (pathArray.length === 2) loadDistricts(pathArray[1]);
                    else if (pathArray.length === 3) loadBlocks(pathArray[1], pathArray[2]);
                    else if (pathArray.length === 4) loadVillages(pathArray[1], pathArray[2], pathArray[3]);
                };
                
                item.textContent = path[i];
                breadcrumb.appendChild(item);
            }
        }

        // Search Functions
        async function performSearch() {
            const query = document.getElementById('search-input').value;
            const statusFilter = document.getElementById('status-filter').value;
            const typeFilter = document.getElementById('type-filter').value;
            
            if (query.length < 2) {
                document.getElementById('search-results').innerHTML = '';
                return;
            }
            
            try {
                const params = new URLSearchParams({
                    q: query,
                    status: statusFilter,
                    type: typeFilter
                });
                
                const response = await fetch(`/api/fra-atlas/search?${params}`);
                const data = await response.json();
                
                displaySearchResults(data.results);
            } catch (error) {
                console.error('Search failed:', error);
            }
        }
        
        function displaySearchResults(results) {
            const container = document.getElementById('search-results');
            container.innerHTML = '';
            
            if (results.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">No results found</div>';
                return;
            }
            
            for (const result of results) {
                const item = document.createElement('div');
                item.className = 'search-result-item';
                item.onclick = () => {
                    // Center map on result coordinates
                    window.fraAtlas.map.setView(result.coordinates, 12);
                    hideSearchPanel();
                };
                
                item.innerHTML = `
                    <div class="search-result-header">${result.patta_holder}</div>
                    <div class="search-result-details">
                        ${result.village}, ${result.block}, ${result.district}, ${result.state}
                        <br>${result.tribal_group} • ${result.claim_type} • ${result.area_hectares} hectares • ${result.status}
                    </div>
                `;
                
                container.appendChild(item);
            }
        }

        // Filter Functions
        function updateClaimStatusFilter() {
            console.log('Claim status filter updated');
            // Implement filter logic
        }
        
        function updateClaimTypeFilter() {
            console.log('Claim type filter updated');
            // Implement filter logic
        }
        
        function updateTribalGroupFilter() {
            console.log('Tribal group filter updated');
            // Implement filter logic
        }
        
        function updateAreaFilter() {
            const value = document.getElementById('area-range').value;
            document.getElementById('area-value').textContent = `0-${value} hectares`;
            console.log('Area filter updated:', value);
            // Implement filter logic
        }

        // Chatbot functionality
        let chatbotOpen = false;
        
        function toggleChatbot() {
            const container = document.getElementById('chatbot-container');
            chatbotOpen = !chatbotOpen;
            
            if (chatbotOpen) {
                container.classList.add('open');
                document.getElementById('chatbot-input').focus();
            } else {
                container.classList.remove('open');
            }
        }
        
        async function sendMessage() {
            const input = document.getElementById('chatbot-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage(message, 'user');
            input.value = '';
            showTyping();
            
            try {
                // Simulate API call (replace with real chatbot API)
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                removeTyping();
                
                // Mock responses based on message content
                let response = "I understand your question about FRA. Let me help you with that information.";
                let suggestions = ["Tell me more", "Show village data", "Available schemes"];
                
                if (message.toLowerCase().includes('fra')) {
                    response = "The Forest Rights Act (FRA) 2006 recognizes the rights of forest-dwelling communities over land and forest resources. It covers Individual Forest Rights (IFR), Community Rights (CR), and Community Forest Resource Rights (CFR).";
                    suggestions = ["What schemes are available?", "Show eligibility criteria", "Village analysis"];
                } else if (message.toLowerCase().includes('scheme')) {
                    response = "Available schemes include PM-KISAN (₹6,000 annual), Jal Shakti Mission (water infrastructure), MGNREGA (employment guarantee), DAJGUA (tribal development), and Van Dhan Vikas (forest produce marketing).";
                    suggestions = ["Check eligibility", "View village recommendations", "Export data"];
                } else if (message.toLowerCase().includes('village') || message.toLowerCase().includes('khargone')) {
                    response = "Khargone village has 2.5 hectares of approved FRA land under Ram Singh. The land analysis shows 35.5% farmland and 42.3% forest cover, making it eligible for multiple government schemes.";
                    suggestions = ["Show recommendations", "View on map", "Generate report"];
                }
                
                addMessage(response, 'bot');
                addSuggestions(suggestions);
                
            } catch (error) {
                removeTyping();
                addMessage("Sorry, I'm having trouble connecting right now. Please try again later.", 'bot');
            }
        }
        
        function sendSuggestion(suggestion) {
            document.getElementById('chatbot-input').value = suggestion;
            sendMessage();
        }
        
        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatbot-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const avatar = sender === 'bot' ? '🤖' : '👤';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${avatar}</div>
                <div class="message-content">
                    <p>${text}</p>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function addSuggestions(suggestions) {
            const messagesContainer = document.getElementById('chatbot-messages');
            const suggestionsDiv = document.createElement('div');
            suggestionsDiv.className = 'message bot-message';
            
            const suggestionsHTML = suggestions.map(suggestion => 
                `<button class="suggestion-btn" onclick="sendSuggestion('${suggestion}')">${suggestion}</button>`
            ).join('');
            
            suggestionsDiv.innerHTML = `
                <div class="message-avatar">🤖</div>
                <div class="message-content">
                    <p>You might also want to ask:</p>
                    <div class="suggestion-buttons">${suggestionsHTML}</div>
                </div>
            `;
            
            messagesContainer.appendChild(suggestionsDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function showTyping() {
            const messagesContainer = document.getElementById('chatbot-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message bot-message';
            typingDiv.id = 'typing-indicator';
            
            typingDiv.innerHTML = `
                <div class="message-avatar">🤖</div>
                <div class="message-content">
                    <p>Thinking...</p>
                </div>
            `;
            
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function removeTyping() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        // Handle Enter key in chatbot input
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('chatbot-input');
            if (input) {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        });

        // Initialize when page loads
        let fraAtlas;
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🚀 FRA Atlas Ultimate loaded, starting system...');
            fraAtlas = new FRAAtlas();
            window.fraAtlas = fraAtlas;
        });
    </script>
</body>
</html>

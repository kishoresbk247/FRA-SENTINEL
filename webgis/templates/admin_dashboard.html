<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRA Sentinel - Admin Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/unified-buttons.css') }}" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #0d4f3c 0%, #1b5e20 25%, #2e7d32 50%, #4caf50 75%, #81c784 100%);
            --admin-gradient: linear-gradient(135deg, #d32f2f 0%, #f44336 25%, #e57373 50%, #ffcdd2 75%, #ffebee 100%);
            --text-primary: #1a1a1a;
            --text-secondary: #2e7d32;
            --border-radius: 16px;
            --shadow: 0 8px 32px rgba(13, 79, 60, 0.08);
            --spacing-md: 16px;
            --spacing-lg: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f1f8e9 0%, #e8f5e8 100%);
            min-height: 100vh;
        }
        
        .header {
            background: var(--admin-gradient);
            color: white;
            padding: var(--spacing-lg);
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .header-content h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header-controls {
            position: absolute;
            top: 50%;
            right: var(--spacing-lg);
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-lg);
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .admin-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-lg);
        }

        .admin-card {
            background: white;
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow);
            border: 1px solid #e0e0e0;
        }

        .admin-card h2 {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .stat-card {
            background: var(--primary-gradient);
            color: white;
            padding: var(--spacing-md);
            border-radius: var(--border-radius);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .admin-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
        }

        .action-button {
            background: var(--primary-gradient);
            color: white;
            padding: var(--spacing-md);
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(13, 79, 60, 0.2);
        }

        /* Enhanced Action Button Styles */
        .action-button.primary {
            background: var(--primary-gradient);
            color: white;
            border: none;
        }

        .action-button.secondary {
            background: linear-gradient(135deg, #2196f3 0%, #64b5f6 100%);
            color: white;
            border: none;
        }

        .action-button.tertiary {
            background: linear-gradient(135deg, #ff9800 0%, #ffb74d 100%);
            color: white;
            border: none;
        }

        .action-text {
            font-weight: 600;
            font-size: 1rem;
        }

        .action-desc {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 2px;
        }

        /* Chart Styles */
        .chart-container {
            height: 200px;
            margin: var(--spacing-md) 0;
            position: relative;
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-sm);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        /* Activity Styles */
        .activity-filters {
            display: flex;
            gap: 8px;
            margin-bottom: var(--spacing-md);
        }

        .filter-btn {
            background: #f5f5f5;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .filter-btn.active {
            background: var(--primary-gradient);
            color: white;
        }

        .filter-btn:hover {
            background: #e0e0e0;
        }

        .filter-btn.active:hover {
            background: var(--primary-gradient);
        }

        .activity-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            font-size: 1.2rem;
            width: 32px;
            height: 32px;
            background: #f5f5f5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .activity-details {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 2px;
        }

        .activity-time {
            font-size: 0.75rem;
            color: #999;
        }

        .activity-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .activity-status.success {
            background: #d4edda;
            color: #155724;
        }

        .activity-status.pending {
            background: #fff3cd;
            color: #856404;
        }

        /* Health Metrics */
        .health-metrics {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .health-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .health-label {
            font-size: 0.9rem;
            color: #666;
        }

        .health-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .health-bar {
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            overflow: hidden;
        }

        .health-progress {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* AI Insights */
        .ai-insights {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .insight-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--text-secondary);
        }

        .insight-icon {
            font-size: 1.2rem;
        }

        .insight-content {
            flex: 1;
        }

        .insight-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .insight-text {
            font-size: 0.8rem;
            color: #666;
        }

        /* Stat Trends */
        .stat-trend {
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 4px;
        }

        .stat-trend:contains("↗️") {
            color: #4caf50;
        }

        .stat-trend:contains("↘️") {
            color: #f44336;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-md);
        }

        .admin-table th,
        .admin-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .admin-table th {
            background: #f5f5f5;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .back-button {
            position: absolute;
            top: var(--spacing-lg);
            left: var(--spacing-lg);
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }

        @media (max-width: 768px) {
            .admin-container {
                grid-template-columns: 1fr;
            }
            
            .header-controls {
                position: static;
                transform: none;
                justify-content: center;
                margin-top: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <!-- Admin Header -->
    <header class="header">
        <a href="{{ url_for('dashboard') }}" class="back-button">← Back to Main Dashboard</a>
        <div class="header-content">
            <h1>🛠️ FRA Sentinel - Admin Dashboard</h1>
            <p>Administrative Control Panel for CCF, DCF, and RFO Officials</p>
        </div>
        <div class="header-controls">
            <a href="{{ url_for('logout') }}" style="background: rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 6px; text-decoration: none;">
                🚪 Logout
            </a>
        </div>
    </header>

    <!-- Admin Container -->
    <div class="admin-container">
        <!-- Top Row: Statistics & Charts -->
        <div class="admin-row">
            <!-- System Statistics -->
            <div class="admin-card stats-card">
                <h2>📊 System Statistics</h2>
                <div class="admin-stats">
                    <div class="stat-card">
                        <div class="stat-number">1,247</div>
                        <div class="stat-label">Total FRA Claims</div>
                        <div class="stat-trend">↗️ +12%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">892</div>
                        <div class="stat-label">Approved Claims</div>
                        <div class="stat-trend">↗️ +8%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">156</div>
                        <div class="stat-label">Pending Review</div>
                        <div class="stat-trend">↘️ -5%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">199</div>
                        <div class="stat-label">Rejected Claims</div>
                        <div class="stat-trend">↗️ +3%</div>
                    </div>
                </div>
            </div>

            <!-- Performance Chart -->
            <div class="admin-card chart-card">
                <h2>📈 Performance Analytics</h2>
                <div class="chart-container">
                    <canvas id="performanceChart" width="400" height="200"></canvas>
                </div>
                <div class="chart-legend">
                    <div class="legend-item">
                        <span class="legend-color" style="background: #4caf50;"></span>
                        <span>Approved Claims</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #ff9800;"></span>
                        <span>Pending Claims</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #f44336;"></span>
                        <span>Rejected Claims</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Row: Actions & Activity -->
        <div class="admin-row">
            <!-- Enhanced Quick Actions -->
            <div class="admin-card actions-card">
                <h2>⚡ Quick Actions</h2>
                <div class="admin-actions">
                    <a href="{{ url_for('upload_patta') }}" class="btn-unified btn-primary">
                        <span>📄</span>
                        Upload Documents
                    </a>
                    <a href="{{ url_for('admin_panel') }}" class="btn-unified btn-secondary">
                        <span>🔧</span>
                        File Management
                    </a>
                    <button class="btn-unified btn-accent" onclick="generateReport()">
                        <span>📈</span>
                        Generate Reports
                    </button>
                    <button class="btn-unified btn-info" onclick="exportData()">
                        <span>💾</span>
                        Export Data
                    </button>
                    <button class="btn-unified btn-secondary" onclick="systemSettings()">
                        <span>⚙️</span>
                        System Settings
                    </button>
                    <button class="btn-unified btn-primary" onclick="userManagement()">
                        <span>👥</span>
                        User Management
                    </button>
                </div>
            </div>

            <!-- Enhanced Recent Activity -->
            <div class="admin-card activity-card">
                <h2>🕒 Recent Activity</h2>
                <div class="activity-filters">
                    <button class="btn-unified btn-primary btn-sm active" onclick="filterActivity('all')">All</button>
                    <button class="btn-unified btn-secondary btn-sm" onclick="filterActivity('uploads')">Uploads</button>
                    <button class="btn-unified btn-secondary btn-sm" onclick="filterActivity('reviews')">Reviews</button>
                    <button class="btn-unified btn-secondary btn-sm" onclick="filterActivity('system')">System</button>
                </div>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon">📄</div>
                        <div class="activity-content">
                            <div class="activity-title">Patta Document Uploaded</div>
                            <div class="activity-details">CCF Admin uploaded Khargone patta</div>
                            <div class="activity-time">2 minutes ago</div>
                        </div>
                        <div class="activity-status success">✓</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">🔍</div>
                        <div class="activity-content">
                            <div class="activity-title">FRA Claim Reviewed</div>
                            <div class="activity-details">DCF Officer reviewed tribal claim</div>
                            <div class="activity-time">15 minutes ago</div>
                        </div>
                        <div class="activity-status pending">⏳</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">🏘️</div>
                        <div class="activity-content">
                            <div class="activity-title">Village Data Updated</div>
                            <div class="activity-details">RFO Officer updated settlement info</div>
                            <div class="activity-time">1 hour ago</div>
                        </div>
                        <div class="activity-status success">✓</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">💾</div>
                        <div class="activity-content">
                            <div class="activity-title">Automated Backup</div>
                            <div class="activity-details">System performed scheduled backup</div>
                            <div class="activity-time">2 hours ago</div>
                        </div>
                        <div class="activity-status success">✓</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Row: System Health & AI Insights -->
        <div class="admin-row">
            <!-- Enhanced System Health -->
            <div class="admin-card health-card">
                <h2>🏥 System Health</h2>
                <div class="health-metrics">
                    <div class="health-item">
                        <div class="health-label">Server Uptime</div>
                        <div class="health-value">99.8%</div>
                        <div class="health-bar">
                            <div class="health-progress" style="width: 99.8%; background: #4caf50;"></div>
                        </div>
                    </div>
                    <div class="health-item">
                        <div class="health-label">Response Time</div>
                        <div class="health-value">2.3s</div>
                        <div class="health-bar">
                            <div class="health-progress" style="width: 85%; background: #4caf50;"></div>
                        </div>
                    </div>
                    <div class="health-item">
                        <div class="health-label">Storage Usage</div>
                        <div class="health-value">1.2GB / 10GB</div>
                        <div class="health-bar">
                            <div class="health-progress" style="width: 12%; background: #4caf50;"></div>
                        </div>
                    </div>
                    <div class="health-item">
                        <div class="health-label">Active Users</div>
                        <div class="health-value">45</div>
                        <div class="health-bar">
                            <div class="health-progress" style="width: 75%; background: #4caf50;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Insights -->
            <div class="admin-card ai-card">
                <h2>🤖 AI Insights</h2>
                <div class="ai-insights">
                    <div class="insight-item">
                        <div class="insight-icon">🔮</div>
                        <div class="insight-content">
                            <div class="insight-title">Prediction Alert</div>
                            <div class="insight-text">High deforestation risk detected in 3 areas</div>
                        </div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon">📊</div>
                        <div class="insight-content">
                            <div class="insight-title">Trend Analysis</div>
                            <div class="insight-text">FRA claims increasing by 23% this quarter</div>
                        </div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon">🌲</div>
                        <div class="insight-content">
                            <div class="insight-title">Forest Health</div>
                            <div class="insight-text">Forest cover improving by 12% over 6 months</div>
                        </div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-icon">👥</div>
                        <div class="insight-content">
                            <div class="insight-title">Settlement Growth</div>
                            <div class="insight-text">Tribal settlements growing by 8% - infrastructure needed</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize chart on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadRealStats();
            initializeChart();
            startRealTimeUpdates();
        });

        async function loadRealStats() {
            try {
                const response = await fetch('/api/admin/real_stats');
                const data = await response.json();
                
                // Update stat numbers with real data
                document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = data.total_claims.toLocaleString();
                document.querySelector('.stat-card:nth-child(2) .stat-number').textContent = data.approved_claims.toLocaleString();
                document.querySelector('.stat-card:nth-child(3) .stat-number').textContent = data.pending_claims.toLocaleString();
                document.querySelector('.stat-card:nth-child(4) .stat-number').textContent = data.rejected_claims.toLocaleString();
                
                // Update chart data
                if (window.performanceChart) {
                    window.performanceChart.data.datasets[0].data = [data.approved_claims, data.pending_claims, data.rejected_claims];
                    window.performanceChart.update();
                }
                
                console.log('📊 Real stats loaded:', data);
            } catch (error) {
                console.error('❌ Failed to load real stats:', error);
            }
        }

        function initializeChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            window.performanceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Approved Claims', 'Pending Claims', 'Rejected Claims'],
                    datasets: [{
                        data: [892, 156, 199],
                        backgroundColor: [
                            '#4caf50',
                            '#ff9800',
                            '#f44336'
                        ],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        function generateReport() {
            // Show loading state
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span>⏳</span>Generating...';
            btn.disabled = true;

            // Simulate report generation
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.disabled = false;
                alert('📈 Report Generated Successfully!\n\n• FRA Claims Summary\n• Performance Analytics\n• System Health Report\n• AI Insights Summary\n\nDownload available in Reports section.');
            }, 2000);
        }

        function exportData() {
            alert('💾 Data Export Options\n\n• CSV Format - Raw data export\n• Excel Format - Formatted reports\n• PDF Format - Visual reports\n• JSON Format - API data\n• GeoJSON Format - Map data');
        }

        function systemSettings() {
            alert('⚙️ System Settings Panel\n\n• User Management\n• Security Settings\n• Notification Preferences\n• Data Backup Configuration\n• API Integration Settings\n• Performance Monitoring');
        }

        function userManagement() {
            alert('👥 User Management Panel\n\n• Add/Remove Users\n• Role Assignment (CCF, DCF, RFO)\n• Permission Management\n• Activity Monitoring\n• Login History\n• Security Policies');
        }

        function filterActivity(filter) {
            // Update active filter button
            document.querySelectorAll('.activity-filters button').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            });
            event.target.classList.add('active');
            event.target.classList.remove('btn-secondary');
            event.target.classList.add('btn-primary');

            // Filter activity items (simplified)
            const activityItems = document.querySelectorAll('.activity-item');
            activityItems.forEach(item => {
                item.style.display = 'flex';
            });

            console.log(`🔍 Filtering activity by: ${filter}`);
        }

        // Real-time updates
        function startRealTimeUpdates() {
            setInterval(function() {
                updateSystemStats();
                updateActivityFeed();
                updateAIInsights();
            }, 10000); // Update every 10 seconds
        }

        function updateSystemStats() {
            // Animate stat numbers
            const statNumbers = document.querySelectorAll('.stat-number');
            statNumbers.forEach(stat => {
                const currentValue = parseInt(stat.textContent.replace(/[^\d]/g, ''));
                const variation = Math.floor(Math.random() * 5) - 2; // -2 to +2
                const newValue = Math.max(0, currentValue + variation);
                
                if (newValue !== currentValue) {
                    stat.textContent = stat.textContent.replace(/\d+/, newValue);
                }
            });
        }

        function updateActivityFeed() {
            // Add new activity item occasionally
            if (Math.random() < 0.3) { // 30% chance
                const activities = [
                    { icon: '📄', title: 'Document Processed', details: 'AI processed new patta document', status: 'success' },
                    { icon: '🔍', title: 'Claim Reviewed', details: 'Automated review completed', status: 'pending' },
                    { icon: '📊', title: 'Report Generated', details: 'Monthly report auto-generated', status: 'success' },
                    { icon: '🌲', title: 'Forest Analysis', details: 'Satellite data updated', status: 'success' }
                ];
                
                const randomActivity = activities[Math.floor(Math.random() * activities.length)];
                console.log(`🔄 New activity: ${randomActivity.title}`);
            }
        }

        function updateAIInsights() {
            // Update AI insights occasionally
            if (Math.random() < 0.2) { // 20% chance
                const insights = [
                    'Forest health improving by 15% over next quarter',
                    'High deforestation risk in 2 new areas detected',
                    'Tribal settlement growth accelerating by 10%',
                    'Water availability predicted to increase by 18%'
                ];
                
                const randomInsight = insights[Math.floor(Math.random() * insights.length)];
                console.log(`🤖 AI Insight: ${randomInsight}`);
            }
        }

        console.log('🛠️ Enhanced Admin Dashboard loaded successfully');
    </script>
</body>
</html>
